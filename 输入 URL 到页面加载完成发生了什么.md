### 从输入 URL 到页面加载完成发生了什么？

1. 判断输入的内容是否是一个有效的 URL，无效的 URL 自动跳转到对应的搜索页面

2. 浏览器查找当前的 URL，是否存在强缓存。

- 根据 HTTP 的首部字段 Expires(绝对时间) 和 cache-control(max-age 相对时间),来比较缓存是否过期。
- 如果命中强缓存，直接使用缓存的资源。

3. DNS 域名解析 URL 对应的 IP

- 查找本地的 hosts 文件是否有缓存
- 查找本地的 DNS 解析器缓存
- 递归查询本地的 DNS 服务器
- 迭代查询 根-> 顶-> 主 ... 得到对应的 IP

4. HTTPS 协议

- 如果使用的是 HTTPS 协议 则开始 TLS 握手
- 客户端发送 协议版本 随机数 可以使用的加密方法
- 服务端接收后 确认 加密方法 给客户端发送 随机序号 证书
- 客户端确认证书的有效性 生成随机数 使用证书中的公钥对随机数进行加密 再生成 hash 值 发送客户端
- 服务端使用私钥 对数据解密 再生成 hash 发送客户端
- 这时候双发都用用三个随机数,按照之前约定的加密方法用三个随机数生成密钥，以后双方通信前都用密钥进行加密

5. TCP 连接 三次握手

- 客户端发送 SYN 包到服务器
- 服务端接收到 SYN 包 生成 ACK 包 发给客户端
- 客户端确认服务端的 ACK 包 完成连接

6. 请求对应的资源

- 发送请求 得到服务端返回的响应报文
- 判断是否是协商缓存
- 判断响应头是否需要 Keep-Alive 如果没有就断开链接
- 根据响应报文中的压缩方式对响应体解压

7. 浏览器解析 html

- 根据 html 文件构建 DOM 树
- 解析到 CSS 文件的时候开始构建 CSSOM 树 如果遇到的 link 资源 会发送请求 阻塞 CSSOM 树的构建。
- 如果有 preload prefetch 属性则不会阻塞页面渲染
- 当 DOM 树 和 CSSOM 树 构建完成后会根据他们来构建渲染树。根据构建好的布局树对页面进行绘制。
- 如果在解析的过程中遇到 JS 文件，判断是否有 defer 或者 async 属性， 没有 defer 和 async 浏览器会理解加载并执行,会导致页面渲染的阻塞
- defer 有序加载资源并且在 DOM 解析后执行
- async 无序加载资源 并且加载后立即执行

8. TCP 四次挥手

- 客户端发送 FIN 包，告诉服务器数据发送完成,进入半关闭状态,只接收不发送
- 服务端接收到，进入关闭等待状态不再接收客户端发送的数据,给客户端发送一个 ACK 包
- 客户端接收到服务端的确认,进入 FIN-WAIT2 状态
- 服务端发送数据结束后，再给客户端发送一个 FIN 报文
- 客户端接收到 FIN 报文后,进入 TIME-WATI 状态发送 ACK 给服务端
- 服务端接收到 ACK 报文后 断开链接
- 客户端等待 2MSL 没收到回复 后关闭链接
